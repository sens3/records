<!DOCTYPE HTML>
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<title>Cedar 0.0.1 Reference</title>
		<link rel="stylesheet" type="text/css" href="css/styles.css" media="all" />
		<link rel="stylesheet" type="text/css" media="print" href="css/stylesPrint.css" />
		<meta name="generator" content="appledoc 2.0.5 (build 789)" />
	</head>
	<body>
		<header id="top_header">
			<div id="library" class="hideInXcode">
				<h1><a id="libraryTitle" href="index.html">Cedar 0.0.1 </a></h1>
				<a id="developerHome" href="index.html">Pivotal Labs</a>
			</div>
			
			<div id="title" role="banner">
				<h1 class="hideInXcode">Cedar 0.0.1 Reference</h1>
			</div>
			<ul id="headerButtons" role="toolbar"></ul>
		</header>
		<article>
			<div id="overview_contents" role="main">
				<div class="main-navigation navigation-top">
					<a href="hierarchy.html">Next</a>
				</div>
				<div id="header">
					<div class="section-header">
						<h1 class="title title-header">Cedar 0.0.1 Reference</h1>
					</div>		
				</div>
				<div id="container">
					
					<div class="section section-overview index-overview">
						
						
						<h1>Cedar</h1>

<p>BDD-style testing using Objective-C</p>

<h2>Usage</h2>

<h3>Clone from GitHub</h3>

<ul>
<li><p>Don&rsquo;t forget to initialize submodules:</p>

<pre><code>  $ git submodule update --init
</code></pre></li>
</ul>


<h3>Installation</h3>

<ul>
<li><p>Run the <code>installCodeSnippetsAndTemplates</code> script in the Cedar directory.</p>

<pre><code>  $ ./installCodeSnippetsAndTemplates
</code></pre></li>
</ul>


<h3>Non-iOS testing</h3>

<ul>
<li>Select your project in Xcode to bring up the project editor.</li>
<li>Click on &ldquo;Add Target&rdquo;.</li>
<li>Select &ldquo;Cedar&rdquo; under the Mac section.</li>
<li>Select either an OSX Cedar Testing Bundle or a OSX Cedar Spec Suite.  If you
prefer to run a separate target to see your spec results, choose the
spec suite.  If you prefer to run your specs with Xcode&rsquo;s built-in
OCUnit runner, choose the testing bundle.  Name this target Specs, or something
else suitable.</li>
<li>If you&rsquo;re using ARC there are some caveats with using Cedar matchers, see below under &ldquo;Matchers and ARC&rdquo;.</li>
<li>If you created a spec bundle, you must additionally add it to the list of tests
for the intended target:

<ul>
<li>Select the target you want the tests to run against.</li>
<li>Edit the scheme (Cmd-&lt;)</li>
<li>Select Test and then add your spec bundle to the list of tests</li>
</ul>
</li>
<li>You target is now set up and should include an ExampleSpec.mm.  To run it:

<ul>
<li>Spec bundle: Choose Test (Cmd-U) for the target you want to run tests for.</li>
<li>Spec suite: Select your spec suite target and Run/Debug.</li>
</ul>
</li>
</ul>


<h3>iOS testing</h3>

<ul>
<li>Select your project in Xcode to bring up the project editor.</li>
<li>Click on &ldquo;Add Target&rdquo;.</li>
<li>Select &ldquo;Cedar&rdquo; under the iOS section.</li>
<li>Select either an iOS Cedar Testing Bundle or a iOS Cedar Spec Suite.  If you
prefer to run a separate target to see your spec results, choose the
spec suite.  If you prefer to run your specs with Xcode&rsquo;s built-in
OCUnit runner, choose the testing bundle.  Name this target Specs, or something
else suitable.</li>
<li>If you&rsquo;re using ARC there are some caveats with using Cedar matchers, see below under &ldquo;Matchers and ARC&rdquo;.</li>
<li>If you&rsquo;re creating a spec bundle, you must specify the intended target of your tests
when creating it in the Test Target field.  Additionally, once you have created your
spec bundle target, you must then add it to the list of tests for the test target:

<ul>
<li>Select the test target.</li>
<li>Edit the scheme (Cmd-&lt;)</li>
<li>Select Test and then add your spec bundle to the list of tests.</li>
</ul>
</li>
<li>Your target is now set up and should include an ExampleSpec.mm.  To run it:

<ul>
<li>Spec bundle: Choose Test (Cmd-U) for the target you want to run tests for.</li>
<li>Spec suite: Select your spec suite target and Run/Debug.</li>
</ul>
</li>
</ul>


<h4>Running iOS tests suites in headless mode</h4>

<ul>
<li>By default, when you run an iOS test suite target, the results are displayed in a UITableView
in the simulator.  If you prefer to have the results output to the console instead, just add
the <code>CEDAR_HEADLESS_SPECS</code> to the environment of the spec suite target:

<ul>
<li>Select the spec suite target</li>
<li>Edit the scheme (Cmd-&lt;)</li>
<li>Select Run > Arguments</li>
<li>Add <code>CEDAR_HEADLESS_SPECS</code> to the Environment section.</li>
</ul>
</li>
</ul>


<h2>Matchers</h2>

<p>Cedar has a new set of matchers that use C++ templates to circumvent type issues that plague other
matcher libraries.  For example, rather than this (OCHamcrest):</p>

<pre><code>assertThat(aString, equalTo(@"something"));
assertThatInt(anInteger, equalToInt(7));
assertThatInt(anInteger, isNot(equalToInt(9)));
assertThatBool(aBoolean, equalTo(YES));
</code></pre>

<p>you can write the following:</p>

<pre><code>expect(aString).to(equal(@"something"));
expect(anInteger).to(equal(7));
expect(anInteger).to_not(equal(9));
expect(aBoolean).to(equal(YES));
</code></pre>

<p>although you would more likely write the last line as:</p>

<pre><code>expect(aBoolean).to(be_truthy());
</code></pre>

<p>Here is a list of built-in matchers you can use:</p>

<pre><code>expect(...).to(be_nil());

expect(...).to(be_truthy());
expect(...).to_not(be_truthy());

expect(...).to(equal(10));
expect(...).to == 10; // shortcut to the above
expect(...) == 10; // shortcut to the above

expect(...).to(be_greater_than(5));
expect(...).to &gt; 5; // shortcut to the above
expect(...) &gt; 5; // shortcut to the above

expect(...).to(be_greater_than_or_equal_to(10));
expect(...).to(be_gte(10)); // shortcut to the above
expect(...).to &gt;= 10; // shortcut to the above
expect(...) &gt;= 10; // shortcut to the above

expect(...).to(be_less_than(11));
expect(...).to &lt; 11; // shortcut to the above
expect(...) &lt; 11; // shortcut to the above

expect(...).to(be_less_than_or_equal_to(10));
expect(...).to(be_lte(10)); //shortcut to the above
expect(...).to &lt;= 10; // shortcut to the above
expect(...) &lt;= 10; // shortcut to the above

expect(...).to(be_close_to(5)); // default within(.01)
expect(...).to(be_close_to(5).within(.02));

expect(...).to(be_instance_of([NSObject class]));
expect(...).to(be_instance_of([NSObject class]).or_any_subclass());

expect(...).to(be_same_instance_as(object));

expect(...).to(contain(@"something"));
expect(...).to(be_empty());

expect(^{ ... }).to(raise_exception([NSInternalInconsistencyException]));
</code></pre>

<p>These matchers use C++ templates for type deduction.  You&rsquo;ll need to do two things to use them:</p>

<ul>
<li>Change the file extension for each of your spec files from .m to .mm (this will tell the
compiler that the file contains C++ code).</li>
<li><p>Add the following line to the top of your spec files, after the file includes:</p>

<pre><code>  using namespace Cedar::Matchers;
</code></pre></li>
</ul>


<p>It&rsquo;s also theoretically very easy to add your own matchers without modifying the
Cedar library (more on this later).</p>

<p>These matchers will break Apple&rsquo;s GCC compiler, and versions 2.0 and older of the LLVM compiler
(this translates to any compiler shipped with a version of Xcode before 4.1).  Fortunately,
LLVM 2.1 fixes the issues.</p>

<p>Note: If you decide to use another matcher library that uses <code>expect(...)</code> to
build its expectations (e.g. <a href="http://github.com/petejkim/expecta">Expecta</a>) you
will need to add <code>#define CEDAR_MATCHERS_COMPATIBILITY_MODE</code> before importing
<a href="Classes/SpecHelper.html">SpecHelper</a>.h.  That will prevent Cedar from defining a macro that overrides that
library&rsquo;s expect function.</p>

<p>Note: If you prefer RSpec&rsquo;s <code>should</code> syntax you can write your expectations as follows:</p>

<pre><code>    1 + 2 should equal(3);
    glass should_not be_empty();
</code></pre>

<h3>Matchers and ARC</h3>

<p>A bug in the current Xcode compiler currently prevents the type C++ deduction from actually working if you have automatic reference counting enabled.  At this time, this leaves you with a few alternatives:</p>

<ol>
<li><p>Disable ARC for your spec files, but continue to use it for your application code.  You can do this by selecting spec files in the target&rsquo;s &ldquo;Compile Sources&rdquo; build phase and adding the compiler flag <code>-fno-objc-arc</code>.  You can help ensure that you do this by creating a <code>SpecHelper.h</code> file in your spec target that you <code>#import</code> into every spec which contains this guard:</p>

<pre><code> #if __has_feature(objc_arc)
     #error ARC must be disabled for specs!
 #endif
</code></pre></li>
<li><p>Use another matcher library like <a href="http://github.com/petejkim/expecta">Expecta</a>.  Just remove the following line from your spec files:</p>

<pre><code> using namespace Cedar::Matchers;
</code></pre></li>
</ol>


<h2>Shared example groups</h2>

<p>Cedar supports shared example groups; you can declare them in one of two ways:
either inline with your spec declarations, or separately.</p>

<p>Declaring shared examples inline with your specs is the simplest:</p>

<pre><code>SPEC_BEGIN(FooSpecs)

sharedExamplesFor(@"a similarly-behaving thing", ^(NSDictionary *context) {
    it(@"should do something common", ^{
        ...
    });
});

describe(@"Something that shares behavior", ^{
    itShouldBehaveLike(@"a similarly-behaving thing");
});

describe(@"Something else that shares behavior", ^{
    itShouldBehaveLike(@"a similarly-behaving thing");
});

SPEC_END
</code></pre>

<p>Sometimes you&rsquo;ll want to put shared examples in a separate file so you can use
them in several specs across different files.  You can do this using macros
specifically for declaring shared example groups:</p>

<pre><code>SHARED_EXAMPLE_GROUPS_BEGIN(GloballyCommon)

sharedExamplesFor(@"a thing with globally common behavior", ^(NSDictionary *context) {
    it(@"should do something really common", ^{
        ...
    });
});

SHARED_EXAMPLE_GROUPS_END
</code></pre>

<p>The context dictionary allows you to pass example-specific state into the shared
example group.  You can populate the context dictionary available on the <a href="Classes/SpecHelper.html">SpecHelper</a>
object, and each shared example group will receive it:</p>

<pre><code>sharedExamplesFor(@"a red thing", ^(NSDictionary *context) {
    it(@"should be red", ^{
        Thing *thing = [context objectForKey:@"thing"];
        expect(thing.color).to(equal(red));
    });
});

describe(@"A fire truck", ^{
    beforeEach(^{
        [[SpecHelper specHelper].sharedExampleContext setObject:[FireTruck fireTruck] forKey:@"thing"];
    });
    itShouldBehaveLike(@"a red thing");
});

describe(@"An apple", ^{
    beforeEach(^{
        [[SpecHelper specHelper].sharedExampleContext setObject:[Apple apple] forKey:@"thing"];
    });
    itShouldBehaveLike(@"a red thing");
});
</code></pre>

<h2>Global beforeEach and afterEach</h2>

<p>In many cases you have some housekeeping you&rsquo;d like to take care of before every spec in your entire
suite.  For example, loading fixtures or resetting a global variable.  Cedar will look for the
+beforeEach and +afterEach class methods on every class it loads; you can add this class method
onto any class you compile into your specs and Cedar will run it.  This allows spec libraries to
provide global +beforeEach and +afterEach methods specific to their own functionality, and they
will run automatically.</p>

<p>If you want to run your own code before or after every spec, simply declare a class and implement
the +beforeEach and/or +afterEach methods.</p>

<h2>Mocks and stubs</h2>

<p>Doubles.  Got &lsquo;em.</p>

<pre><code>spy_on(someInstance);
idCedarDouble fake = fake_for(someClass);
idCedarDouble anotherFake = fake_for(someProtocol);
idCedarDouble niceFake = nice_fake_for(someClass);
idCedarDouble anotherNiceFake = nice_fake_for(someProtocol);
</code></pre>

<p>Method stubbing:</p>

<pre><code>fake stub_method("selector").with(x);
fake stub_method("selector").with(x).and_with(y);
fake stub_method("selector").and_return(z);
fake stub_method("selector").with(x).and_return(z);
fake stub_method("selector").and_raise_exception();
fake stub_method("selector").and_raise_exception([NSException]);
fake stub_method("selector").with(anything);
</code></pre>

<h2>Pending specs</h2>

<p>If you&rsquo;d like to specify but not implement an example you can do so like this:</p>

<pre><code>      it(@"should do something eventually", PENDING);
</code></pre>

<p>The spec runner will not try to run this example, but report it as pending.  The
PENDING keyword simply references a nil block pointer; if you prefer you can
explicitly pass nil as the second parameter.  The parameter is necessary because
C, and thus Objective-C, doesn&rsquo;t support function parameter overloading or
default parameters.</p>

<h2>Focused specs</h2>

<p>Sometimes when debugging or developing a new feature it is useful to run only a
subset of your tests.  That can be achieved by marking any number/combination of
examples with an &lsquo;f&rsquo;. You can use <code>fit</code>, <code>fdescribe</code> and <code>fcontext</code> like this:</p>

<pre><code>      fit(@"should do something eventually", ^{
          // ...
      });
</code></pre>

<p>If your test suite has at least one focused example, all focused examples will
run and non-focused examples will be skipped and reported as such (shown as &lsquo;>&rsquo;
in default reporter output).</p>

<p>It might not be immediately obvious why the test runner always returns a
non-zero exit code when a test suite contains at least one focused example. That
was done to make CI fail if someone accidently forgets to unfocus focused
examples before commiting and pushing.</p>

<h2>Reporters</h2>

<p>When running in headless mode by default Cedar uses <code>CDRDefaultReporter</code> to
output test results.  Here is how it looks:</p>

<pre><code>.P..P..

PENDING CDRExample hasChildren should return false by default
PENDING CDRExample hasFocusedExamples should return false by default

Finished in 0.0166 seconds
7 examples, 0 failures, 2 pending
</code></pre>

<p>Most of the time above output is exactly what you want to see; however, in some
cases you might actually want to see full names of running examples.  You can get
more detailed output by setting <code>CEDAR_REPORTER_OPTS</code> env variable to <code>nested</code>.
Here is how it looks after that:</p>

<pre><code>   CDRExample
     hasChildren
.      should return false
     isFocused
P      should return false by default
.      should return false when example is not focused
.      should return true when example is focused
     hasFocusedExamples
P      should return false by default
.      should return false when example is not focused
.      should return true when example is focused

PENDING CDRExample hasChildren should return false by default
PENDING CDRExample hasFocusedExamples should return false by default

Finished in 0.0173 seconds
7 examples, 0 failures, 2 pending
</code></pre>

<p>If the default reporter for some reason does not fit your needs you can always
write a custom reporter.  <code>CDRTeamCityReporter</code> is one such example.  It was
written to output test results in a way that TeamCity CI server can understand.
You can tell Cedar which reporter to use by setting <code>CEDAR_REPORTER_CLASS</code> env
variable to your custom reporter class <a href="Classes/name.html">name</a>.</p>

<h3>JUnit XML Reporting</h3>

<p>The <code>CDRJUnitXMLReporter</code> can be used to generate (simple) JUnit compatible
XML that can be read by build servers such as Jenkins. To use this reporter,
you can take advantage of the ability to specify multiple reporters like so:</p>

<pre><code>CEDAR_REPORTER_CLASS=CDRColorizedReporter,CDRJUnitXMLReporter
</code></pre>

<p>By default, the XML file will be written to <code>build/TEST-Cedar.xml</code> but this
path can be overridden with the <code>CEDAR_JUNIT_XML_FILE</code> env variable.</p>

<h2>Code Snippets</h2>

<p>Code snippets are installed as part of Cedar.  These are installed into
<code>~/Library/Developer/XCode/UserData/CodeSnippets</code></p>

<h2>Command line automation</h2>

<p>The Rakefile contains useful rake tasks that let you run cedar specs from the
command line.  The <code>ocunit:logic</code> and <code>ocunit:application</code> tasks demonstrate how
you can run OCUnit style test bundles.  The <code>specs</code> and <code>uispecs</code> tasks show how
you can run cedar test suites.</p>

<h2>Troubleshooting</h2>

<h3>Linker problem ld: file not found</h3>

<p>Example failure:</p>

<pre><code>ld: file not found: &lt;path to build dir&gt;/Products/&lt;Configuration&gt;-&lt;device&gt;/&lt;target name.app/&lt;target name
clang: error: linker command failed with exit code 1 (use -v to see invocation)
</code></pre>

<ul>
<li>This error occurs when there is an incorrect target <a href="Classes/name.html">name</a> used.</li>
<li>To fix this, Update the <code>Bundle Loader</code> setting in build settings to
<code>$(BUILT_PRODUCTS_DIR)/&lt;target name.app/&lt;target name</code>
Ensuring that your new target <a href="Classes/name.html">name</a> is the correct.</li>
</ul>


<h3>Linker problem ld: symbol(s) not found</h3>

<p>Example failure:</p>

<pre><code>Undefined symbols for architecture i386:
"_OBJC_CLASS_$_SomeClassFromYourApp", referenced from:
    objc-class-ref in SomeClassFromYourAppSpec.o
    (maybe you meant: _OBJC_CLASS_$__OBJC_CLASS_$_SomeClassFromYourApp)
ld: symbol(s) not found for architecture i386
</code></pre>

<p>This error can happen when you have a spec bundle which is run against code built with &ldquo;Strip Debug Symbols During Copy&rdquo; set to Yes.</p>

<p>You should ensure that you&rsquo;re running your tests against code built with this configuration setting set to No.  This should be the default if you&rsquo;re building with the Debug configuration.</p>

<h3>No matching function to call</h3>

<p>Example failure:</p>

<pre><code>error: no matching function for call to 'CDR_expect'
note: candidate template ignored: substitution failure [with T = SOME_TYPE]
</code></pre>

<ul>
<li>This is caused by a C++ compiler bug in Xcode when ARC is enabled and you use a Cedar matcher.  See the above section &ldquo;Matchers and ARC&rdquo; on how to deal with this.</li>
</ul>


<h2>Contributions and feedback</h2>

<p>Welcomed!  Feel free to join and contribute to the public Tracker project <a href="http://www.pivotaltracker.com/projects/77775">here</a>.</p>

<p>The <a href="http://groups.google.com/group/cedar-discuss">public Google group</a> for Cedar is cedar-discuss@googlegroups.com.
Or, you can follow the growth of Cedar on Twitter: <a href="http://twitter.com/cedarbdd">@cedarbdd</a>.</p>

<p>Copyright &copy; 2011 Pivotal Labs. This software is licensed under the MIT License.</p>
						
						
					</div>
					
                        
                    
					
					
					<div class="index-column">
						<h2 class="index-title">Class References</h2>
						<ul>
							
							<li><a href="Classes/CDRClassFake.html">CDRClassFake</a></li>
							
							<li><a href="Classes/CDRColorizedReporter.html">CDRColorizedReporter</a></li>
							
							<li><a href="Classes/CDRDefaultReporter.html">CDRDefaultReporter</a></li>
							
							<li><a href="Classes/CDRExample.html">CDRExample</a></li>
							
							<li><a href="Classes/CDRExampleBase.html">CDRExampleBase</a></li>
							
							<li><a href="Classes/CDRExampleDetailsViewController.html">CDRExampleDetailsViewController</a></li>
							
							<li><a href="Classes/CDRExampleGroup.html">CDRExampleGroup</a></li>
							
							<li><a href="Classes/CDRExampleReporterViewController.html">CDRExampleReporterViewController</a></li>
							
							<li><a href="Classes/CDRExampleStateMap.html">CDRExampleStateMap</a></li>
							
							<li><a href="Classes/CDRFake.html">CDRFake</a></li>
							
							<li><a href="Classes/CDRJUnitXMLReporter.html">CDRJUnitXMLReporter</a></li>
							
							<li><a href="Classes/CDROTestIPhoneRunner.html">CDROTestIPhoneRunner</a></li>
							
							<li><a href="Classes/CDROTestReporter.html">CDROTestReporter</a></li>
							
							<li><a href="Classes/CDROTestRunner.html">CDROTestRunner</a></li>
							
							<li><a href="Classes/CDRProtocolFake.html">CDRProtocolFake</a></li>
							
							<li><a href="Classes/CDRSharedExampleGroupPool.html">CDRSharedExampleGroupPool</a></li>
							
							<li><a href="Classes/CDRSpec.html">CDRSpec</a></li>
							
							<li><a href="Classes/CDRSpecFailure.html">CDRSpecFailure</a></li>
							
							<li><a href="Classes/CDRSpecStatusCell.html">CDRSpecStatusCell</a></li>
							
							<li><a href="Classes/CDRSpecStatusViewController.html">CDRSpecStatusViewController</a></li>
							
							<li><a href="Classes/CDRSpy.html">CDRSpy</a></li>
							
							<li><a href="Classes/CDRTeamCityReporter.html">CDRTeamCityReporter</a></li>
							
							<li><a href="Classes/CedarApplication.html">CedarApplication</a></li>
							
							<li><a href="Classes/CedarApplicationDelegate.html">CedarApplicationDelegate</a></li>
							
							<li><a href="Classes/CedarDoubleImpl.html">CedarDoubleImpl</a></li>
							
							<li><a href="Classes/SharedExampleGroupPoolFor.html">SharedExampleGroupPoolFor</a></li>
							
							<li><a href="Classes/SpecHelper.html">SpecHelper</a></li>
							
							<li><a href="Classes/name.html">name</a></li>
							
						</ul>
					</div>
					
					
						
					<div class="index-column">
						
						<h2 class="index-title">Protocol References</h2>
						<ul>
							
							<li><a href="Protocols/(.html">(</a></li>
							
							<li><a href="Protocols/CDRExampleParent.html">CDRExampleParent</a></li>
							
							<li><a href="Protocols/CDRExampleReporter.html">CDRExampleReporter</a></li>
							
							<li><a href="Protocols/CDRSharedExampleGroupPool.html">CDRSharedExampleGroupPool</a></li>
							
							<li><a href="Protocols/CDRSpec.html">CDRSpec</a></li>
							
							<li><a href="Protocols/CedarDouble.html">CedarDouble</a></li>
							
						</ul>
						
						
					</div>
					
				</div>
				<div class="main-navigation navigation-bottom">
					<a href="hierarchy.html">Next</a>
				</div>
				<div id="footer">
					<hr />
					<div class="footer-copyright">
						<p><span class="copyright">&copy; 2012 Pivotal Labs. All rights reserved. (Last updated: 2012-10-25)</span><br />
						
						<span class="generator">Generated by <a href="http://appledoc.gentlebytes.com">appledoc 2.0.5 (build 789)</a>.</span></p>
						
	
					</div>
				</div>
			</div>
		</article>		
	</body>
</html>